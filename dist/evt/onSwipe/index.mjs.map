{"version":3,"file":"index.mjs","sources":[""],"sourcesContent":["import { getWindow } from \"ssr-window\";\r\nimport { isTouchDevice } from \"../../user/isTouchDevice/index.ts\";\r\nimport { bubble } from \"../bubble/index.ts\";\r\n\r\ntype TSupportedEvents =\r\n  | { type: \"pointer\"; start: \"pointerdown\"; move: \"pointermove\"; end: \"pointerup\"; cancel: \"pointercancel\"; leave: \"pointerleave\"; }\r\n  | { type: \"touch\"; start: \"touchstart\"; move: \"touchmove\"; end: \"touchend\"; cancel: \"touchcancel\"; leave: \"touchleave\"; }\r\n  | { type: \"mouse\"; start: \"mousedown\"; move: \"mousemove\"; end: \"mouseup\"; leave: \"mouseleave\"; };\r\n\r\n/**\r\n * Adds a device-agnostic swipe detector for an element (pointer, touch, or mouse).\r\n * Dispatches a \"swipe\" `CustomEvent` or calls the provided callback.\r\n *\r\n * @template TDetail\r\n * @param {Element|Document} el Target to listen for gestures\r\n * @param {{\r\n *   callback?: (detail: TDetail) => void;\r\n *   minDist?: number;\r\n *   maxDist?: number;\r\n *   minTime?: number;\r\n *   maxTime?: number;\r\n * }} [props={}] Swipe configuration\r\n * @param {boolean} [isAutoInit=true] Attach listeners immediately\r\n * @returns {{\r\n *   handler: { start: (e: Event) => void; move: (e: Event) => void; end: (e: Event) => void };\r\n *   addListener: () => void;\r\n *   removeListener: () => void;\r\n * }}\r\n * @throws {TypeError} onSwipe: el must be an Element or Document\r\n * @throws {TypeError} onSwipe: props must be an object\r\n * @throws {TypeError} onSwipe: callback must be a function if provided\r\n * @throws {TypeError} onSwipe: minDist/maxDist/minTime/maxTime must be finite numbers if provided\r\n *\r\n * @example\r\n * onSwipe(document.getElementById(\"box\")!, { callback: ({ dir }) => console.log(dir) });\r\n */\r\nexport const onSwipe = <TDetail extends {\r\n  originEvent: Event;\r\n  dir: \"left\" | \"right\" | \"up\" | \"down\";\r\n  dist: number;\r\n  time: number;\r\n  supportedEvents: TSupportedEvents;\r\n} = {\r\n  originEvent: Event;\r\n  dir: \"left\" | \"right\" | \"up\" | \"down\";\r\n  dist: number;\r\n  time: number;\r\n  supportedEvents: TSupportedEvents;\r\n}>(\r\n  el: Element | Document,\r\n  props: {\r\n    callback?: (detail: TDetail) => void;\r\n    minDist?: number;\r\n    maxDist?: number;\r\n    minTime?: number;\r\n    maxTime?: number;\r\n  } = {},\r\n  isAutoInit: boolean = true\r\n): { handler: { start: (e: Event) => void; move: (e: Event) => void; end: (e: Event) => void; }; addListener: () => void; removeListener: () => void; } => {\r\n  if (!el || typeof (el as any).addEventListener !== \"function\") {\r\n    throw new TypeError(\"onSwipe: el must be an Element or Document\");\r\n  }\r\n  if (props === null || typeof props !== \"object\") {\r\n    throw new TypeError(\"onSwipe: props must be an object\");\r\n  }\r\n  const {\r\n    callback, minDist, maxDist, minTime, maxTime,\r\n  } = props as any;\r\n  if (typeof callback !== \"undefined\" && typeof callback !== \"function\") {\r\n    throw new TypeError(\"onSwipe: callback must be a function if provided\");\r\n  }\r\n  for (const [ k, v ] of Object.entries({\r\n    minDist, maxDist, minTime, maxTime,\r\n  })) {\r\n    if (typeof v !== \"undefined\" && (typeof v !== \"number\" || !Number.isFinite(v))) {\r\n      throw new TypeError(`onSwipe: ${k} must be a finite number if provided`);\r\n    }\r\n  }\r\n\r\n  const settings = {\r\n    minDist: 60,\r\n    maxDist: 120,\r\n    maxTime: 700,\r\n    minTime: 50,\r\n    callback: null as null | ((detail: TDetail) => void),\r\n    ...props,\r\n  };\r\n\r\n  if (settings.maxTime < settings.minTime) {\r\n    settings.maxTime = settings.minTime + 500;\r\n  }\r\n\r\n  if (settings.maxTime < 100 || settings.minTime < 50) {\r\n    settings.maxTime = 700;\r\n    settings.minTime = 50;\r\n  }\r\n\r\n  const eventsUnify = (e: MouseEvent | TouchEvent | PointerEvent | CustomEvent | Event) => {\r\n    const te = e as TouchEvent;\r\n    if (typeof te.changedTouches !== \"undefined\" && te.changedTouches && te.changedTouches.length) {\r\n      return te.changedTouches[0];\r\n    }\r\n    return e as unknown as { pageX?: number; pageY?: number; };\r\n  };\r\n\r\n  const isSupport = {\r\n    pointer: (\"PointerEvent\" in getWindow() || (\"msPointerEnabled\" in (getWindow().navigator as unknown as { msPointerEnabled?: unknown; }))),\r\n    touch: isTouchDevice(),\r\n  };\r\n\r\n  const getSupportedEvents = (): TSupportedEvents => {\r\n    if (isSupport.pointer) {\r\n      return {\r\n        type: \"pointer\",\r\n        start: \"pointerdown\",\r\n        move: \"pointermove\",\r\n        end: \"pointerup\",\r\n        cancel: \"pointercancel\",\r\n        leave: \"pointerleave\",\r\n      };\r\n    }\r\n    if (isSupport.touch) {\r\n      return {\r\n        type: \"touch\",\r\n        start: \"touchstart\",\r\n        move: \"touchmove\",\r\n        end: \"touchend\",\r\n        cancel: \"touchcancel\",\r\n        leave: \"touchleave\",\r\n      };\r\n    }\r\n    return {\r\n      type: \"mouse\",\r\n      start: \"mousedown\",\r\n      move: \"mousemove\",\r\n      end: \"mouseup\",\r\n      leave: \"mouseleave\",\r\n    };\r\n  };\r\n\r\n  const events = getSupportedEvents();\r\n\r\n  let dir: \"none\" | \"left\" | \"right\" | \"up\" | \"down\",\r\n    swipeType: \"none\" | \"left\" | \"right\" | \"up\" | \"down\",\r\n    dist: number,\r\n    isMouse = false,\r\n    isMouseDown = false,\r\n    startX = 0,\r\n    distX = 0,\r\n    startY = 0,\r\n    distY = 0,\r\n    startTime = 0;\r\n\r\n  const checkStart = (e: Event): void => {\r\n    const event: any = eventsUnify(e);\r\n    const t = e as TouchEvent;\r\n    if (isSupport.touch && typeof t.touches !== \"undefined\" && t.touches.length !== 1) {\r\n      return;\r\n    }\r\n    dir = \"none\";\r\n    swipeType = \"none\";\r\n    dist = 0;\r\n    startX = (event.pageX ?? (e as unknown as { detail?: { _pageX?: number; }; })?.detail?._pageX ?? 0);\r\n    startY = (event.pageY ?? (e as unknown as { detail?: { _pageY?: number; }; })?.detail?._pageY ?? 0);\r\n    startTime = Date.now();\r\n    if (isMouse) {\r\n      isMouseDown = true;\r\n    }\r\n  };\r\n\r\n  const checkMove = (e: Event): void => {\r\n    if (isMouse && !isMouseDown) {\r\n      return;\r\n    }\r\n    const event: any = eventsUnify(e);\r\n    distX = (event.pageX ?? (e as any)?.detail?._pageX ?? 0) - startX;\r\n    distY = (event.pageY ?? (e as any)?.detail?._pageY ?? 0) - startY;\r\n    if (Math.abs(distX) > Math.abs(distY)) {\r\n      dir = (distX < 0) ? \"left\" : \"right\";\r\n    } else {\r\n      dir = (distY < 0) ? \"up\" : \"down\";\r\n    }\r\n  };\r\n\r\n  const checkEnd = (e: Event): void => {\r\n    if (isMouse && !isMouseDown) {\r\n      isMouseDown = false;\r\n      return;\r\n    }\r\n\r\n    const endTime = Date.now();\r\n    const time = endTime - startTime;\r\n\r\n    if (time >= settings.minTime && time <= settings.maxTime) {\r\n      if (Math.abs(distX) >= settings.minDist && Math.abs(distY) <= settings.maxDist) {\r\n        swipeType = dir;\r\n      } else if (Math.abs(distY) >= settings.minDist && Math.abs(distX) <= settings.maxDist) {\r\n        swipeType = dir;\r\n      }\r\n    }\r\n\r\n    dist = (dir === \"left\" || dir === \"right\") ? Math.abs(distX) : Math.abs(distY);\r\n\r\n    const ce = e as CustomEvent<{ _swipeType?: \"left\" | \"right\" | \"up\" | \"down\"; _pageX?: number; _pageY?: number; }>;\r\n    if (ce?.detail?._swipeType) {\r\n      swipeType = ce.detail._swipeType;\r\n    }\r\n\r\n    if (swipeType !== \"none\" && dist >= settings.minDist) {\r\n      const detail = {\r\n        originEvent: e,\r\n        dir: swipeType as \"left\" | \"right\" | \"up\" | \"down\",\r\n        dist,\r\n        time,\r\n        supportedEvents: events as TSupportedEvents,\r\n      } as TDetail;\r\n      if (typeof settings.callback === \"function\") {\r\n        settings.callback(detail);\r\n      } else {\r\n        bubble(el as any, \"swipe\", detail, {\r\n          bubbles: true,\r\n          cancelable: true,\r\n        });\r\n      }\r\n    }\r\n  };\r\n\r\n  const handler = {\r\n    start: (e: Event): void => checkStart(e),\r\n    end: (e: Event): void => checkEnd(e),\r\n    move: (e: Event): void => checkMove(e),\r\n  };\r\n\r\n  if ((isSupport.pointer && !isSupport.touch) || events.type === \"mouse\") {\r\n    isMouse = true;\r\n  }\r\n\r\n  const listenerCtrl = (isBind: boolean = true): void => {\r\n    const action: \"addEventListener\" | \"removeEventListener\" = isBind ? \"addEventListener\" : \"removeEventListener\";\r\n    (el as unknown as EventTarget)[action](events.start, handler.start as EventListener);\r\n    (el as unknown as EventTarget)[action](events.move, handler.move as EventListener);\r\n    (el as unknown as EventTarget)[action](events.end, handler.end as EventListener);\r\n    if (isSupport.pointer && isSupport.touch) {\r\n      (el as unknown as EventTarget)[action](\"lostpointercapture\", handler.end as EventListener);\r\n    }\r\n  };\r\n\r\n  const addListener = (): void => {\r\n    listenerCtrl(true);\r\n  };\r\n\r\n  const removeListener = (): void => {\r\n    listenerCtrl(false);\r\n  };\r\n\r\n  if (isAutoInit) {\r\n    addListener();\r\n  }\r\n\r\n  return {\r\n    handler,\r\n    addListener,\r\n    removeListener,\r\n  };\r\n};\r\n"],"names":["onSwipe","el","props","isAutoInit","addEventListener","TypeError","callback","minDist","maxDist","minTime","maxTime","k","v","Object","entries","Number","isFinite","settings","eventsUnify","e","te","changedTouches","length","isSupport","pointer","getWindow","navigator","touch","isTouchDevice","getSupportedEvents","type","start","move","end","cancel","leave","events","dir","swipeType","dist","isMouse","isMouseDown","startX","distX","startY","distY","startTime","checkStart","event","t","touches","pageX","detail","_pageX","pageY","_pageY","Date","now","checkMove","Math","abs","checkEnd","endTime","time","ce","_swipeType","originEvent","supportedEvents","bubble","bubbles","cancelable","handler","listenerCtrl","isBind","action","addListener","removeListener"],"mappings":"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"}